# ✅ Use an official slim Python image
FROM python:3.11-slim  

# ✅ Set working directory
WORKDIR /app

# ✅ Install system dependencies (LibreOffice for PDF generation)
RUN apt-get update && \
    apt-get install -y libreoffice && \
    rm -rf /var/lib/apt/lists/*

# ✅ Set environment variables to prevent locale errors
ENV LANG=C.UTF-8 \
    LC_ALL=C.UTF-8 \
    DEBIAN_FRONTEND=noninteractive 

# ✅ Copy only requirements.txt first (caching layer optimization)
COPY requirements.txt .  

# ✅ Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt  

# ✅ Copy the entire project files into the container
COPY . .  
RUN which soffice

# ✅ Expose the correct port (Render dynamically assigns a port)
EXPOSE 10000  

# ✅ Set the command to run the application with correct timeout and workers
CMD gunicorn app:app --bind 0.0.0.0:$PORT --timeout 120 --workers 3
